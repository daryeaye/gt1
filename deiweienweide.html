<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Lost Treasure Pt1 Captain Jay</title>

  <link href="https://fonts.googleapis.com/css2?family=Caveat&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@700&display=swap" rel="stylesheet" />

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <!-- PDF.js (Google Sites-safe PDF rendering) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      overflow-y: auto;
      background: url('https://daryeaye.github.io/geotopia/thatsit.png') no-repeat center center fixed;
      background-size: cover;
    }

    body {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 10px 0 40px;
      box-sizing: border-box;
    }

    #app-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
    }

    /* Sticky header so progress bar is always visible */
    #header {
      width: 960px;
      background: #eee;
      padding: 10px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;

      position: sticky;
      top: 0;
      z-index: 2000;
      box-shadow: 0 2px 6px rgba(0,0,0,0.12);
    }

    #header input#username {
      font-size: 16px;
      padding: 5px;
    }

    #confirmBtn {
      margin-left: 10px;
      font-size: 16px;
      padding: 5px 10px;
      cursor: pointer;
    }

    #progressBar {
      flex: 1;
      background: #ccc;
      height: 20px;
      margin: 0 10px;
      position: relative;
    }

    #progress {
      background: green;
      height: 100%;
      width: 0%;
    }

    #progressText {
      font-size: 16px;
    }

    #main-area {
      width: 100%;
      display: flex;
      justify-content: center;
    }

    /* wrapper anchors the nav buttons without affecting canvas centering */
    #main-wrapper {
      position: relative;
      width: 960px;
    }

    #container {
      position: relative;
      width: 960px;
      height: 540px;
      border: 1px solid #ccc;
      background: white;
      overflow: hidden;
    }

    .page {
      position: absolute;
      top: 0;
      left: 0;
      width: 960px;
      height: 540px;
      display: none;
    }

    .page.active {
      display: block;
    }

    .box {
      position: absolute;
      background-color: rgba(200, 200, 200, 0.5);
    }

    .textbox {
      position: absolute;
      background-color: rgba(255, 255, 224, 0.7);
      border: 1px solid black;
      font-family: "Comic Sans MS", sans-serif;
      font-size: 20px;
      color: black;
      padding: 2px;
      box-sizing: border-box;
    }

    .caveat { font-family: "Caveat", cursive; }
    .transparent { background-color: transparent; }

    .ellipse {
      position: absolute;
      border: 3px solid red;
      border-radius: 50%;
      background-color: transparent;
    }

    .drawingCanvas {
      position: absolute;
      left: 0;
      top: 0;
      z-index: 5;
    }

    .drawingResetBtn {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 10;
      font-family: "Comic Sans MS", sans-serif;
      font-size: 20px;
      background-color: lightblue;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
    }

    /* Prev/Next: left side, vertically centered, close to canvas */
    #nav-buttons {
      position: absolute;
      top: 50%;
      left: -150px;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    button {
      font-family: "Comic Sans MS", sans-serif;
      font-size: 20px;
      background-color: lightblue;
      border: none;
      padding: 10px 20px;
      margin: 0;
      cursor: pointer;
    }

    .draggable { cursor: move; }

    #side-widget {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 200px;
      height: 200px;
      background: #f9f9f9;
      border: 1px solid #ccc;
      padding: 10px;
      box-sizing: border-box;
      font-family: 'Caveat', cursive;
      z-index: 999;
    }

    #side-widget p.title {
      font-size: 24px;
      text-align: center;
      margin: 0 0 10px;
    }

    #side-widget button, #side-widget a {
      display: block;
      margin: 0 auto;
      font-size: 20px;
      cursor: pointer;
      text-align: center;
      background: lightblue;
      border: none;
      padding: 10px;
      text-decoration: none;
      color: inherit;
    }

    #selection-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      cursor: crosshair;
      z-index: 1000;
    }

    #selection-box {
      position: absolute;
      border: 2px dashed red;
      background: rgba(0, 0, 0, 0.1);
    }

    /* ==============================
       SECOND CANVAS (same size as main canvas)
       Uses 1600x900 design scaled down to 960x540 via CSS transform.
       ============================== */

    #role-container {
      position: relative;
      width: 960px;
      height: 540px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      margin-top: 10px;
      overflow: hidden;
      background: #fff;
    }

    /* Inner stage is 1600x900, scaled to fit 960x540 */
    #role-stage {
      position: absolute;
      top: 0;
      left: 0;
      width: 1600px;
      height: 900px;

      transform-origin: top left;
      transform: scale(0.6); /* 960/1600 = 0.6 and 540/900 = 0.6 */

      background: url('https://daryeaye.github.io/geotopia/role.jpg') no-repeat center/cover;
    }

    .role-hotspot {
      position: absolute;
      background: rgba(255,0,0,0); /* invisible */
      border: none;
      padding: 0;
      margin: 0;
      cursor: pointer;
    }

    /* PDF.js viewer fills role-container (960x540) once chosen */
    #pdfViewer {
      position: absolute;
      inset: 0;
      display: none;
      overflow-y: auto;
      overflow-x: hidden;
      background: #fff;
      z-index: 5;
    }

    .pdfPageCanvas {
      display: block;
      margin: 12px auto;
      background: white;
    }

    #pdfStatus {
      position: absolute;
      top: 10px;
      left: 10px;
      font-family: "Comic Sans MS", sans-serif;
      font-size: 14px;
      color: #111;
      background: rgba(255,255,255,0.85);
      padding: 6px 10px;
      border: 1px solid rgba(0,0,0,0.15);
      border-radius: 6px;
      z-index: 10;
      display: none;
    }

    /* hides role-stage (background + hotspots) once PDF is active */
    #role-container.pdf-mode #role-stage {
      display: none;
    }
  </style>
</head>

<body>
  <div id="app-container">
    <div id="header">
      <div id="header-top">
        <div>
          <input type="text" id="username" placeholder="Enter your name" style="font-size:16px; padding:5px;" />
          <button id="confirmBtn" onclick="confirmName()">Confirm</button>
        </div>
      </div>

      <div id="progressBar">
        <div id="progress"></div>
      </div>

      <span id="progressText">0% completed</span>
    </div>

    <div id="main-area">
      <div id="main-wrapper">
        <div id="nav-buttons">
          <button id="prev-btn" onclick="prevPage()">Previous</button>
          <button id="next-btn" onclick="nextPage()">Next</button>
        </div>

        <div id="container">
          <div id="page1" class="page active" style="background:url('https://daryeaye.github.io/gt1/1-1.jpg') no-repeat center/cover;"></div>
          <div id="page2" class="page" style="background:url('https://daryeaye.github.io/gt1/1-2.jpg') no-repeat center/cover;"></div>

          <div id="page3" class="page" style="background:url('https://daryeaye.github.io/gt1/1-3.jpg') no-repeat center/cover;">
            <input type="text" class="textbox" style="left:380px;top:134px;width:129px;height:31px;">
            <input type="text" class="textbox" style="left:805px;top:134px;width:111px;height:31px;">
            <input type="text" class="textbox" style="left:709px;top:201px;width:119px;height:31px;">
            <input type="text" class="textbox" style="left:644px;top:253px;width:73px;height:31px;">
            <input type="text" class="textbox" style="left:689px;top:286px;width:119px;height:31px;">
            <input type="text" class="textbox" style="left:602px;top:371px;width:110px;height:31px;">
            <input type="text" class="textbox" style="left:577px;top:403px;width:97px;height:31px;">
            <input type="text" class="textbox" style="left:380px;top:436px;width:129px;height:31px;">
            <input type="text" class="textbox" style="left:709px;top:437px;width:111px;height:31px;">
          </div>

          <div id="page4" class="page" style="background:url('https://daryeaye.github.io/gt1/1-4.jpg') no-repeat center/cover;">
            <input type="text" class="textbox" style="left:447px;top:257px;width:488px;height:98px;">
            <input type="text" class="textbox" style="left:448px;top:449px;width:487px;height:77px;">
            <div class="ellipse draggable" style="left:509.5px;top:108px;width:41px;height:160px;transform:rotate(90deg);"></div>
          </div>

          <div id="page5" class="page" style="background:url('https://daryeaye.github.io/gt1/1-5.jpg') no-repeat center/cover;">
            <input type="text" class="textbox" style="left:447px;top:257px;width:488px;height:98px;">
            <input type="text" class="textbox" style="left:448px;top:449px;width:487px;height:77px;">
            <div class="ellipse draggable" style="left:509.5px;top:108px;width:41px;height:160px;transform:rotate(90deg);"></div>
          </div>

          <div id="page6" class="page" style="background:url('https://daryeaye.github.io/gt1/1-6.jpg') no-repeat center/cover;">
            <input type="text" class="textbox" style="left:444px;top:177px;width:487px;height:107px;">
            <input type="text" class="textbox" style="left:444px;top:401px;width:487px;height:108px;">
          </div>

          <div id="page7" class="page" style="background:url('https://daryeaye.github.io/gt1/1-7.jpg') no-repeat center/cover;">
            <input type="text" class="textbox" style="left:443px;top:170px;width:487px;height:148px;">
            <input type="text" class="textbox" style="left:443px;top:457px;width:487px;height:42px;">
          </div>

          <div id="page8" class="page" style="background:url('https://daryeaye.github.io/gt1/1-8.jpg') no-repeat center/cover;">
            <input type="text" class="textbox" style="left:443px;top:173px;width:487px;height:159px;">
            <div class="ellipse draggable" style="left:510px;top:361px;width:40px;height:160px;transform:rotate(90deg);"></div>
          </div>

          <div id="page9" class="page" style="background:url('https://daryeaye.github.io/gt1/1-9.jpg') no-repeat center/cover;">
            <input type="text" class="textbox" style="left:443px;top:173px;width:487px;height:159px;">
            <div class="ellipse draggable" style="left:510px;top:361px;width:40px;height:160px;transform:rotate(90deg);"></div>
          </div>

          <div id="page10" class="page" style="background:url('https://daryeaye.github.io/gt1/1-10.jpg') no-repeat center/cover;"></div>

          <div id="page11" class="page" style="background:url('https://daryeaye.github.io/gt1/1-11.jpg') no-repeat center/cover;">
            <input type="text" class="textbox" style="left:443px;top:173px;width:487px;height:167px;">
            <input type="text" class="textbox" style="left:443px;top:423px;width:487px;height:54px;">
          </div>

          <div id="page12" class="page" style="background:url('https://daryeaye.github.io/gt1/1-12.jpg') no-repeat center/cover;">
            <input type="text" class="textbox" style="left:443px;top:121px;width:487px;height:157px;">
            <input type="text" class="textbox" style="left:443px;top:402px;width:487px;height:105px;">
          </div>

          <div id="page13" class="page" style="background:url('https://daryeaye.github.io/gt1/1-13.jpg') no-repeat center/cover;">
            <button id="drawingCanvas13_reset" class="drawingResetBtn">Reset</button>
            <canvas id="drawingCanvas13" class="drawingCanvas" width="960" height="540"></canvas>
          </div>

          <div id="page14" class="page" style="background:url('https://daryeaye.github.io/gt1/1-14.jpg') no-repeat center/cover;">
            <button id="drawingCanvas14_reset" class="drawingResetBtn">Reset</button>
            <canvas id="drawingCanvas14" class="drawingCanvas" width="480" height="540"></canvas>
            <input type="text" class="textbox" style="position:absolute;left:590px;top:187px;width:340px;height:68px;" placeholder="Textbox 1">
            <input type="text" class="textbox" style="position:absolute;left:601px;top:271px;width:340px;height:69px;" placeholder="Textbox 2">
            <input type="text" class="textbox" style="position:absolute;left:549px;top:351px;width:340px;height:69px;" placeholder="Textbox 3">
            <input type="text" class="textbox" style="position:absolute;left:569px;top:430px;width:340px;height:69px;" placeholder="Textbox 4">
          </div>

          <div id="page15" class="page" style="background:url('https://daryeaye.github.io/gt1/1-15.jpg') no-repeat center/cover;">
            <button id="drawingCanvas15_reset" class="drawingResetBtn">Reset</button>
            <canvas id="drawingCanvas15" class="drawingCanvas" width="960" height="540"></canvas>
          </div>

          <div id="page16" class="page" style="background:url('https://daryeaye.github.io/gt1/1-16.jpg') no-repeat center/cover;">
            <button id="drawingCanvas16_reset" class="drawingResetBtn">Reset</button>
            <canvas id="drawingCanvas16" class="drawingCanvas" width="480" height="540"></canvas>
            <input type="text" class="textbox" style="position:absolute;left:590px;top:187px;width:340px;height:68px;" placeholder="Textbox 1">
            <input type="text" class="textbox" style="position:absolute;left:605px;top:271px;width:338px;height:69px;" placeholder="Textbox 2">
            <input type="text" class="textbox" style="position:absolute;left:548px;top:350px;width:339px;height:69px;" placeholder="Textbox 3">
            <input type="text" class="textbox" style="position:absolute;left:570px;top:429px;width:339px;height:68px;" placeholder="Textbox 4">
          </div>

          <div id="page17" class="page" style="background:url('https://daryeaye.github.io/gt1/1-17.jpg') no-repeat center/cover;"></div>

          <div id="page18" class="page" style="background:url('https://daryeaye.github.io/gt1/1-18.jpg') no-repeat center/cover;">
            <input type="text" class="textbox caveat" id="unlockInput" style="left:372px;top:378px;width:172px;height:52px;" placeholder="Enter answer">
            <button id="unlockBtn" style="position:absolute;left:550px;top:390px;font-family:'Caveat',cursive;font-size:16px;padding:5px;cursor:pointer;">Unlock</button>
          </div>

          <div id="page19" class="page" style="background:url('https://daryeaye.github.io/gt1/1-19.jpg') no-repeat center/cover;">
            <a href="https://daryeaye.github.io/gt1/weide.html" target="_blank">
              <div class="box" style="left:310px;top:435px;width:370px;height:45px;background-color:rgba(255,0,0,0.5);"></div>
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- SECOND CANVAS (same visible size as first: 960x540) -->
    <div id="role-container" aria-label="Role selection canvas">
      <div id="pdfStatus">Loading PDF...</div>

      <!-- 1600x900 design stage scaled to 960x540 -->
      <div id="role-stage">
        <button class="role-hotspot" id="hotspot-officer"
                style="left:195px; top:121px; width:328px; height:276px;"
                aria-label="Officer" title="Officer"></button>

        <button class="role-hotspot" id="hotspot-professor"
                style="left:637px; top:121px; width:328px; height:277px;"
                aria-label="Professor" title="Professor"></button>

        <button class="role-hotspot" id="hotspot-hacker"
                style="left:1079px; top:121px; width:328px; height:277px;"
                aria-label="Hacker" title="Hacker"></button>

        <button class="role-hotspot" id="hotspot-video"
                style="left:502px; top:767px; width:596px; height:51px;"
                aria-label="What is the file for?" title="What is the file for?"></button>
      </div>

      <!-- PDF.js viewer (fills the 960x540 area) -->
      <div id="pdfViewer"></div>
    </div>
  </div>

  <script>
    /* -----------------------------
       Main canvas paging (unchanged)
       ----------------------------- */
    let currentPage = 1, totalPages = 19, maxPageVisited = 1;

    function nextPage() {
      const pagesToCheck = [3,4,5,6,7,8,9,11,12,14,16,18];
      if (pagesToCheck.includes(currentPage) && !checkAnswer(currentPage)) {
        alert("Oops. Some answers are incorrect. Let's try again!");
        return;
      }
      if (currentPage === totalPages) return;
      currentPage++;
      if (currentPage > maxPageVisited) maxPageVisited = currentPage;
      showPage(currentPage);
    }

    function prevPage() {
      currentPage--;
      if (currentPage < 1) currentPage = totalPages;
      showPage(currentPage);
    }

    function showPage(p) {
      for (let i = 1; i <= totalPages; i++) {
        document.getElementById("page" + i).classList.remove("active");
      }
      document.getElementById("page" + p).classList.add("active");
      document.getElementById("next-btn").style.display = p === totalPages ? "none" : "inline-block";
      document.getElementById("prev-btn").style.display = p === 1 ? "none" : "inline-block";
      updateProgress();
    }

    function updateProgress() {
      let p = (maxPageVisited / totalPages) * 100;
      document.getElementById("progress").style.width = p + "%";
      document.getElementById("progressText").innerText = p.toFixed(0) + "% completed";
    }

    function initDrawingCanvas(canvasId, resetBtnId, preloadDefaults = false, freeDraw = false) {
      const canvas = document.getElementById(canvasId),
            ctx = canvas.getContext("2d"),
            resetBtn = document.getElementById(resetBtnId);

      let drawing = false, startX = 0, startY = 0, lines = [];

      function getMousePos(e) {
        const rect = canvas.getBoundingClientRect();
        return { x: e.clientX - rect.left, y: e.clientY - rect.top };
      }

      function redraw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        lines.forEach(line => {
          ctx.beginPath();
          ctx.moveTo(line.startX, line.startY);
          ctx.lineTo(line.endX, line.endY);
          ctx.strokeStyle = "red";
          ctx.lineWidth = 2;
          ctx.stroke();
        });
      }

      if (preloadDefaults) {
        lines.push({ startX: 255, startY: 89, endX: 382, endY: 89 });
        lines.push({ startX: 277, startY: 117, endX: 404, endY: 117 });
        redraw();
      }

      canvas.addEventListener("mousedown", function (e) {
        if (lines.length >= 2 && !freeDraw) return;
        let pos = getMousePos(e);
        drawing = true;
        startX = pos.x;
        startY = pos.y;
      });

      canvas.addEventListener("mousemove", function (e) {
        if (!drawing) return;
        redraw();
        let pos = getMousePos(e);
        ctx.beginPath();
        ctx.moveTo(startX, startY);
        ctx.lineTo(pos.x, pos.y);
        ctx.strokeStyle = "red";
        ctx.lineWidth = 2;
        ctx.stroke();
      });

      canvas.addEventListener("mouseup", function (e) {
        if (!drawing) return;
        drawing = false;
        let pos = getMousePos(e);
        lines.push({ startX: startX, startY: startY, endX: pos.x, endY: pos.y });
        redraw();
      });

      canvas.addEventListener("mouseleave", function () {
        if (drawing) {
          drawing = false;
          redraw();
        }
      });

      resetBtn.addEventListener("click", function () {
        lines = [];
        if (preloadDefaults) {
          lines.push({ startX: 255, startY: 89, endX: 382, endY: 89 });
          lines.push({ startX: 277, startY: 117, endX: 404, endY: 117 });
        }
        redraw();
      });
    }

    function initUnlockButton() {
      const unlockBtn = document.getElementById("unlockBtn"),
            unlockInput = document.getElementById("unlockInput");
    
      unlockBtn.addEventListener("click", function () {
        if (unlockInput.value.trim() === "200") {
    
          // 1️⃣ Open the PDF
          window.open("https://daryeaye.github.io/geotopia/jimi.pdf", "_blank");
    
          // 2️⃣ Move to page 19
          currentPage = 19;
          if (currentPage > maxPageVisited) maxPageVisited = currentPage;
          showPage(currentPage);
    
        } else {
          alert("Oops. Some answers are incorrect. Let's try again!");
        }
      });
    }


    function confirmName() {
      const nameInput = document.getElementById("username"),
            name = nameInput.value.trim();

      if (name !== "") {
        localStorage.setItem("username", name);
        nameInput.disabled = true;
        alert("Name confirmed as: " + name);
      } else {
        alert("Please enter a name.");
      }
    }

    /* -----------------------------
       PDF.js viewer (2nd canvas)
       ----------------------------- */
    function initPdfJs() {
      pdfjsLib.GlobalWorkerOptions.workerSrc =
        "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";
    }

    async function renderPdfIntoSecondCanvas(pdfUrl) {
      const roleContainer = document.getElementById("role-container");
      const viewer = document.getElementById("pdfViewer");
      const status = document.getElementById("pdfStatus");

      // Hide role-stage (background + hotspots)
      roleContainer.classList.add("pdf-mode");

      viewer.style.display = "block";
      viewer.innerHTML = "";
      viewer.scrollTop = 0;

      status.style.display = "block";
      status.textContent = "Loading PDF...";

      try {
        const loadingTask = pdfjsLib.getDocument({ url: pdfUrl });
        const pdf = await loadingTask.promise;

        status.textContent = "Rendering pages...";

        // Fit to viewer width
        const targetWidth = 920; // a bit padding inside 960
        for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
          const page = await pdf.getPage(pageNum);

          const viewport1 = page.getViewport({ scale: 1 });
          const scale = targetWidth / viewport1.width;
          const viewport = page.getViewport({ scale });

          const canvas = document.createElement("canvas");
          canvas.className = "pdfPageCanvas";
          canvas.width = Math.floor(viewport.width);
          canvas.height = Math.floor(viewport.height);

          const ctx = canvas.getContext("2d", { alpha: false });
          viewer.appendChild(canvas);

          await page.render({ canvasContext: ctx, viewport }).promise;
        }

        status.style.display = "none";
      } catch (err) {
        console.error("PDF.js render error:", err);
        status.textContent = "Failed to load PDF (see Console).";
      }
    }

    function initSecondCanvasHotspots() {
      document.getElementById("hotspot-officer").addEventListener("click", function () {
        renderPdfIntoSecondCanvas("https://daryeaye.github.io/geotopia/GT1%20Officer+.pdf");
      });

      document.getElementById("hotspot-professor").addEventListener("click", function () {
        renderPdfIntoSecondCanvas("https://daryeaye.github.io/geotopia/GT1%20Professor+.pdf");
      });

      document.getElementById("hotspot-hacker").addEventListener("click", function () {
        renderPdfIntoSecondCanvas("https://daryeaye.github.io/geotopia/GT1%20Hacker+.pdf");
      });

      document.getElementById("hotspot-video").addEventListener("click", function () {
        window.open("https://www.youtube.com/watch?v=Fj98o3aFfk8", "_blank");
      });
    }

    document.addEventListener("DOMContentLoaded", function () {
      initPdfJs();

      initDrawingCanvas("drawingCanvas13", "drawingCanvas13_reset", false, false);
      initDrawingCanvas("drawingCanvas15", "drawingCanvas15_reset", false, false);
      initDrawingCanvas("drawingCanvas14", "drawingCanvas14_reset", false, false);
      initDrawingCanvas("drawingCanvas16", "drawingCanvas16_reset", false, false);

      const inputs = document.querySelectorAll('input[type="text"]');
      inputs.forEach((input, index) => {
        const key = "textbox-" + index;
        input.dataset.key = key;
        if (localStorage.getItem(key)) input.value = localStorage.getItem(key);
        input.addEventListener("input", function () {
          localStorage.setItem(key, input.value);
        });
      });

      document.querySelectorAll(".draggable").forEach(el => {
        el.addEventListener("mousedown", function (e) {
          const style = window.getComputedStyle(el),
                startLeft = parseFloat(style.left),
                startTop = parseFloat(style.top),
                startX = e.clientX,
                startY = e.clientY;

          function mouseMoveHandler(e) {
            const dx = e.clientX - startX,
                  dy = e.clientY - startY;

            el.style.left = (startLeft + dx) + "px";
            el.style.top = (startTop + dy) + "px";
          }

          document.addEventListener("mousemove", mouseMoveHandler);
          document.addEventListener("mouseup", function onMouseUp() {
            document.removeEventListener("mousemove", mouseMoveHandler);
            document.removeEventListener("mouseup", onMouseUp);
          });

          e.preventDefault();
        });
      });

      initUnlockButton();
      initSecondCanvasHotspots();
      showPage(currentPage);
    });

    function checkAnswer(pageNum) {
      let valid = true;
      switch (pageNum) {
        case 3: {
          const inputs = document.querySelectorAll("#page3 .textbox");
          let filled = 0;
          inputs.forEach(input => { if (input.value.trim() !== "") filled++; });
          if (filled < 5) valid = false;
          break;
        }
        case 4: {
          const inputs = document.querySelectorAll("#page4 .textbox");
          if (inputs.length < 2) valid = false;
          else {
            if (!inputs[0].value.includes("60")) valid = false;
            if (!inputs[1].value.toLowerCase().includes("no")) valid = false;
          }
          break;
        }
        case 5: {
          const inputs = document.querySelectorAll("#page5 .textbox");
          if (inputs.length < 1 || !inputs[0].value.includes("60")) valid = false;
          break;
        }
        case 6: {
          const inputs = document.querySelectorAll("#page6 .textbox");
          if (inputs.length < 2) valid = false;
          else {
            if (!inputs[0].value.includes("13")) valid = false;
            if (!inputs[1].value.includes("60")) valid = false;
          }
          break;
        }
        case 7: {
          const inputs = document.querySelectorAll("#page7 .textbox");
          if (inputs.length < 2) valid = false;
          else {
            if (!inputs[0].value.includes("3")) valid = false;
            if (!inputs[1].value.toLowerCase().includes("zoid")) valid = false;
          }
          break;
        }
        case 8: {
          const inputs = document.querySelectorAll("#page8 .textbox");
          if (inputs.length < 1 || !inputs[0].value.includes("10")) valid = false;
          break;
        }
        case 9: {
          const inputs = document.querySelectorAll("#page9 .textbox");
          if (inputs.length < 1 || !inputs[0].value.includes("20")) valid = false;
          break;
        }
        case 11: {
          const inputs = document.querySelectorAll("#page11 .textbox");
          if (inputs.length < 2) valid = false;
          else {
            if (!inputs[0].value.includes("16.8")) valid = false;
            if (!inputs[1].value.toLowerCase().includes("tuse")) valid = false;
          }
          break;
        }
        case 12: {
          const inputs = document.querySelectorAll("#page12 .textbox");
          if (inputs.length < 1 || !inputs[0].value.includes("9")) valid = false;
          break;
        }
        case 14: {
          const inputs = document.querySelectorAll("#page14 .textbox");
          if (inputs.length < 4) valid = false;
          else {
            if (!inputs[3].value.includes("127")) valid = false;
          }
          break;
        }
        case 16: {
          const inputs = document.querySelectorAll("#page16 .textbox");
          if (inputs.length < 4) valid = false;
          else {
            if (!inputs[3].value.includes("65")) valid = false;
          }
          break;
        }
        case 18: {
          const input = document.querySelector("#page18 .textbox");
          if (!input || input.value.trim() !== "200") valid = false;
          break;
        }
      }
      return valid;
    }
  </script>

  <div id="side-widget">
    <p class="title">Need translation?</p>
    <button id="select-text">Select Text</button>
    <p>
      <a href="https://translate.google.com/?sl=en&tl=es&op=images" target="_blank">
        Click me and paste from clipboard
      </a>
    </p>
  </div>

  <script>
    document.getElementById("select-text").addEventListener("click", function () {
      const overlay = document.createElement("div");
      overlay.id = "selection-overlay";
      document.body.appendChild(overlay);

      let startX, startY, selectionBox;

      overlay.addEventListener("mousedown", function (e) {
        startX = e.clientX;
        startY = e.clientY;

        selectionBox = document.createElement("div");
        selectionBox.id = "selection-box";
        selectionBox.style.left = startX + "px";
        selectionBox.style.top = startY + "px";
        selectionBox.style.width = "0px";
        selectionBox.style.height = "0px";
        overlay.appendChild(selectionBox);

        function mouseMoveHandler(e) {
          const currentX = e.clientX,
                currentY = e.clientY,
                rectLeft = Math.min(startX, currentX),
                rectTop = Math.min(startY, currentY),
                rectWidth = Math.abs(currentX - startX),
                rectHeight = Math.abs(currentY - startY);

          selectionBox.style.left = rectLeft + "px";
          selectionBox.style.top = rectTop + "px";
          selectionBox.style.width = rectWidth + "px";
          selectionBox.style.height = rectHeight + "px";
        }

        function mouseUpHandler() {
          overlay.removeEventListener("mousemove", mouseMoveHandler);
          overlay.removeEventListener("mouseup", mouseUpHandler);

          const boxRect = selectionBox.getBoundingClientRect();
          document.body.removeChild(overlay);

          const target = document.getElementById("container"),
                targetRect = target.getBoundingClientRect();

          html2canvas(target, { useCORS: true, allowTaint: false }).then(canvas => {
            const scaleFactor = canvas.width / targetRect.width,
                  sx = (boxRect.left - targetRect.left) * scaleFactor,
                  sy = (boxRect.top - targetRect.top) * scaleFactor,
                  sWidth = boxRect.width * scaleFactor,
                  sHeight = boxRect.height * scaleFactor,
                  croppedCanvas = document.createElement("canvas");

            croppedCanvas.width = sWidth;
            croppedCanvas.height = sHeight;

            const ctx = croppedCanvas.getContext("2d");
            ctx.drawImage(canvas, sx, sy, sWidth, sHeight, 0, 0, sWidth, sHeight);

            croppedCanvas.toBlob(blob => {
              if (blob) {
                const item = new ClipboardItem({ "image/png": blob });
                navigator.clipboard.write([item]).then(() => {
                  alert("Screenshot copied to clipboard.");
                }).catch(err => {
                  console.error("Failed to copy screenshot to clipboard", err);
                  alert("Failed to copy screenshot to clipboard.");
                });
              }
            });
          });
        }

        overlay.addEventListener("mousemove", mouseMoveHandler);
        overlay.addEventListener("mouseup", mouseUpHandler);
      });
    });
  </script>

  <!-- ©XDY. All rights reserved. This code is the intellectual property of XDY. Unauthorized copying, reproduction, or redistribution is strictly prohibited. For educational use only. Contact the author for permissions. -->
</body>
</html>
